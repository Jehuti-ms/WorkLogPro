<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="WorkLog Pro">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#4361ee">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>WorkLog - Student Tracker & Hours Management</title>
  <link rel="manifest" href="app.webmanifest">
  <link rel="icon" type="image/svg+xml" href="icons/favicon_cogs32x32.svg">
  <link rel="stylesheet" href="styles.css">
</head>

  <!-- Auth Gate -->
<div id="authGate" class="auth-gate">
  <h2>ğŸ” Welcome to WorkLog Pro</h2>
  <p>Please sign in or register to continue.</p>
  <button id="signInBtn" class="btn btn-primary">Sign In with Google</button>
</div>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>
        <img src="icons/worklog_cogs.svg" alt="WorkLog" style="height: 100px; width: 100px;">
      </h1>
      <h1>WorkLog</h1>
      <p class="subtitle">Student Tracker & Hours Management System</p>

      <div class="storage-status">
        <span id="localStatus">ğŸ’¾ Local Storage: Active</span>
        <span id="syncStatus">â˜ï¸ Cloud Sync: Ready</span>
        <span id="dataStatus">ğŸ“Š Data: 0 Students, 0 Sessions</span>   

        <!-- Auth Section inside header -->
         <div class="auth-section dropdown">
              <button id="authButton" class="btn btn-sm btn-outline-dark dropdown-toggle">
                ğŸ‘¤ <span id="userName">Loading...</span>
              </button>
              <div id="userMenu" class="dropdown-menu dropdown-menu-end">
                <div class="dropdown-item-text">
                  <strong id="userDisplayName">User</strong><br>
                  <small id="userEmail">user@example.com</small>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item-text">
                  <strong>ğŸ“Š Usage Stats</strong><br>
                  <small>Students: <span id="statStudents">0</span></small><br>
                  <small>Hours Worked: <span id="statHours">0</span></small><br>
                  <small>Money Earned: $<span id="statEarnings">0.00</span></small>
                </div>
                <div class="dropdown-item-text">
                  <small>Last updated: <span id="statUpdated">Never</span></small>
                </div>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item text-danger" id="logoutBtn">ğŸšª Logout</button>
              </div>
            </div>
      </header>

         <!-- Cloud Sync Bar -->
        <div class="cloud-sync-bar">
          <div class="sync-status">
            <span class="sync-indicator sync-connected" id="syncIndicator"></span>
            <span id="syncMessage">Cloud Sync: Ready</span>
            <div id="syncMessageLine" class="sync-message-line">Status: Not synced yet</div>
          </div>
        
          <div class="sync-toolbar">
            <label class="auto-sync-label">
              <input type="checkbox" id="autoSyncCheckbox"> Auto-sync
            </label>
            <button id="syncBtn" class="btn btn-sm btn-primary">ğŸ”„ Sync Now</button>
            <span id="autoSyncDot" class="auto-sync-dot" style="display:none;"></span>
        
            <button id="exportCloudBtn" class="btn btn-sm btn-success">Export Cloud</button>
            <button id="importCloudBtn" class="btn btn-sm btn-info">Import Cloud</button>
            <button id="syncStatsBtn" class="btn btn-sm btn-light">Sync Stats</button>
        
            <button id="exportDataBtn" class="btn btn-sm btn-primary">ğŸ“¤ Export Data</button>
            <button id="importDataBtn" class="btn btn-sm btn-primary">ğŸ“¥ Import Data</button>
            <button id="clearDataBtn" class="btn btn-sm btn-danger">ğŸ—‘ï¸ Clear All</button>
         </div>

   <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab active" data-tab="students">ğŸ‘¥ Students</button>
        <button class="tab" data-tab="hours">â±ï¸ Hours</button>
        <button class="tab" data-tab="marks">ğŸ“Š Marks</button>
        <button class="tab" data-tab="attendance">âœ… Attendance</button>
        <button class="tab" data-tab="payments">ğŸ’° Payments</button>
        <button class="tab" data-tab="reports">ğŸ“ˆ Reports</button>
      </div>
    </div>

   <!-- Students Tab -->
<div id="students" class="tab-content active">
  <div class="section-header">
    <h2>ğŸ“š Student Management</h2>
    <div class="student-stats">
      <span class="stat-badge" id="studentCount">0</span>
      <span class="stat-divider">|</span>
      <span class="stat-text">Avg Rate: $<span id="averageRate">0.00</span>/session</span>
    </div>
  </div>

  <!-- Default Rate Settings -->
  <div class="default-rate-panel">
    <h4>ğŸ’° Default Rate Settings</h4>
    <div class="form-group">
      <label for="defaultBaseRate">Set Default Rate ($/session)</label>
      <div class="rate-input-wrapper">
        <span class="currency-symbol">$</span>
        <input type="number" id="defaultBaseRate" step="0.01" min="0" placeholder="25.00">
        <span class="rate-suffix">/ session</span>
      </div>
      <div class="help-text">This rate will be automatically filled for new students</div>
    </div>
    <div class="current-rate-display">
      <span class="current-label">Current Default Rate:</span>
      <span class="current-value">$<span id="currentDefaultRate">0.00</span>/session</span>
    </div>
    <div class="rate-actions">
      <button type="button" class="btn btn-success" onclick="saveDefaultRate()">ğŸ’¾ Save Default Rate</button>
      <button type="button" class="btn btn-warning" onclick="applyDefaultRateToAll()">ğŸ”„ Apply to All Students</button>
      <button type="button" class="btn btn-secondary" onclick="useDefaultRate()">ğŸ“ Use in Student Form</button>
    </div>
  </div>

  <!-- Student Registration Form -->
  <div class="section-card">
    <h3>ğŸ‘¤ Student Registration</h3>
    <form id="studentForm">
      <div class="form-grid">
        <div class="form-group">
          <label for="studentName">Full Name *</label>
          <input type="text" id="studentName" required>
        </div>
        <div class="form-group">
          <label for="studentId">Student ID *</label>
          <input type="text" id="studentId" required>
        </div>
        <div class="form-group">
          <label for="studentGender">Gender *</label>
          <select id="studentGender" required>
            <option value="">Select gender</option>
            <option>Male</option><option>Female</option><option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="studentEmail">Email</label>
          <input type="email" id="studentEmail">
        </div>
        <div class="form-group">
          <label for="studentPhone">Phone</label>
          <input type="tel" id="studentPhone">
        </div>
        <div class="form-group">
          <label for="studentBaseRate">Base Rate ($/session)</label>
          <input type="number" id="studentBaseRate" step="0.01" min="0">
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-primary" onclick="addStudent()">â• Add Student</button>
        <button type="button" class="btn btn-secondary" onclick="clearStudentForm()">ğŸ—‘ï¸ Clear Form</button>
      </div>
    </form>
  </div>

  <!-- Student List -->
  <div class="section-card">
    <div class="section-header">
      <h3>ğŸ“‹ Registered Students</h3>
      <div class="list-controls">
        <input type="text" id="studentSearch" placeholder="ğŸ” Search students...">
      </div>
    </div>
    <div class="students-container" id="studentsContainer">
      <p style="color:#666;text-align:center;padding:40px;">No students registered yet.</p>
    </div>
  </div>
</div>

<!-- Hours Tab -->
<div id="hours" class="tab-content">
  <div class="section-header">
    <h2>â±ï¸ Earnings Tracker</h2>
    <div class="student-stats">
      <span class="stat-text">This Week: <span id="weeklyHours">0</span>h / $<span id="weeklyTotal">0</span></span>
      <span class="stat-divider">|</span>
      <span class="stat-text">This Month: <span id="monthlyHours">0</span>h / $<span id="monthlyTotal">0</span></span>
    </div>
  </div>
  <div class="form-grid">
    <div class="section-card">
      <h3>â• Log Work & Earnings</h3>
      <!-- hours form -->
      <div class="form-group"><label>Organization *</label><input id="organization" required></div>
      <div class="form-group"><label>Work Type</label>
        <select id="workType"><option value="hourly">Hourly</option><option value="session">Per-Session</option></select>
      </div>
      <div class="form-group"><label>Date *</label><input type="date" id="workDate" required></div>
      <div class="form-group"><label>Hours Worked *</label><input type="number" id="hoursWorked" step="0.5" required></div>
      <div class="form-group"><label>Your Hourly Rate *</label>
        <input type="number" id="baseRate" step="0.01" required>
        <button type="button" class="btn btn-sm" onclick="useDefaultRateInHours()">Use Default ($<span id="currentDefaultRateDisplay">25.00</span>)</button>
      </div>
      <div class="form-group"><label>Total Earnings</label><input id="totalPay" readonly></div>
      <div class="form-actions">
        <button type="button" class="btn btn-primary" onclick="logHours()">ğŸ’¾ Log Work</button>
        <button type="button" class="btn btn-secondary" onclick="resetHoursForm()">ğŸ—‘ï¸ Clear Form</button>
      </div>
    </div>
    <div class="section-card">
      <h3>ğŸ“Š Recent Earnings</h3>
      <div id="hoursContainer"><p style="color:#666;text-align:center;padding:40px;">No work logged yet.</p></div>
    </div>
  </div>
</div>

<!-- Marks Tab -->
<div id="marks" class="tab-content">
  <div class="section-header">
    <h2>ğŸ“Š Marks & Assessments</h2>
    <div class="student-stats">
      <span class="stat-badge" id="marksCount">0</span>
      <span class="stat-divider">|</span>
      <span class="stat-text">Avg Score: <span id="avgMarks">0%</span></span>
    </div>
  </div>
  <div class="form-grid">
    <div class="section-card">
      <h3>â• Add New Mark</h3>
      <form id="marksForm">
        <div class="form-group"><label>Student *</label><select id="marksStudent" required></select></div>
        <div class="form-group"><label>Subject *</label><input id="markSubject" required></div>
        <div class="form-group"><label>Topic *</label><input id="markTopic" required></div>
        <div class="form-group"><label>Date *</label><input type="date" id="markDate" required></div>
        <div class="form-group"><label>Score *</label><input type="number" id="score" required></div>
        <div class="form-group"><label>Max Score *</label><input type="number" id="maxScore" required></div>
        <div class="form-group"><label>Percentage</label><input id="percentage" readonly></div>
        <div class="form-group"><label>Grade</label><input id="grade" readonly></div>
        <div class="form-actions">
          <button type="button" class="btn btn-primary" onclick="addMark()">ğŸ’¾ Save Mark</button>
          <button type="button" class="btn btn-secondary" onclick="document.getElementById('marksForm').reset()">ğŸ—‘ï¸ Clear Form</button>
        </div>
      </form>
    </div>
    <div class="section-card">
      <h3>ğŸ“‹ Recent Marks</h3>
      <div id="marksContainer"><p style="color:#666;text-align:center;padding:40px;">No marks recorded yet.</p></div>
    </div>
  </div>
</div>

<!-- Attendance Tab -->
<div id="attendance" class="tab-content">
  <div class="section-header">
    <h2>âœ… Attendance Tracking</h2>
    <div class="student-stats">
      <span class="stat-badge" id="attendanceCount">0</span>
      <span class="stat-divider">|</span>
      <span class="stat-text">Last Session: <span id="lastSessionDate">Never</span></span>
    </div>
  </div>

  <div class="form-grid">
    <div class="section-card">
      <h3>ğŸ“… Quick Attendance</h3>
      <div class="form-group"><label>Date *</label><input type="date" id="attendanceDate" required></div>
      <div class="form-group"><label>Subject *</label><input type="text" id="attendanceSubject" required></div>
      <div class="form-group"><label>Topic</label><input type="text" id="attendanceTopic"></div>

      <div class="attendance-container">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
          <h4 style="margin:0;">Select Present Students:</h4>
          <div class="attendance-quick-actions">
            <button type="button" class="btn btn-sm" onclick="selectAllStudents()">âœ… Select All</button>
            <button type="button" class="btn btn-sm" onclick="deselectAllStudents()">âŒ Deselect All</button>
          </div>
        </div>
        <div id="attendanceList">
          <p style="color:#666;text-align:center;padding:20px;">No students registered. Add students first.</p>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-primary" onclick="saveAttendance()">ğŸ’¾ Save Attendance</button>
        <button type="button" class="btn btn-secondary" onclick="clearAttendanceForm()">ğŸ—‘ï¸ Clear Form</button>
      </div>
    </div>

    <div class="section-card">
      <h3>ğŸ“‹ Recent Attendance</h3>
      <div id="attendanceContainer">
        <p style="color:#666;text-align:center;padding:40px;">No attendance records yet.</p>
      </div>
    </div>
  </div>
</div>

    <!-- Payments Tab -->
<div id="payments" class="tab-content">
  <div class="section-header">
    <h2>ğŸ’° Payment Management</h2>
    <div class="student-stats">
      <span class="stat-text">Total Students: <span id="totalStudentsCount">0</span></span>
      <span class="stat-divider">|</span>
      <span class="stat-text">Total Owed: <span id="totalOwed">$0</span></span>
      <span class="stat-divider">|</span>
      <span class="stat-text">This Month: <span id="monthlyPayments">$0</span></span>
    </div>
  </div>

  <div class="form-grid">
    <div class="section-card">
      <h3>ğŸ’³ Record Payment</h3>
      <div class="form-group"><label>Student *</label><select id="paymentStudent" required></select></div>
      <div class="form-group"><label>Amount ($) *</label><input type="number" id="paymentAmount" step="0.01" min="0.01" required></div>
      <div class="form-group"><label>Date *</label><input type="date" id="paymentDate" required></div>
      <div class="form-group"><label>Method</label>
        <select id="paymentMethod">
          <option>Cash</option><option>Bank Transfer</option><option>Credit Card</option><option>PayPal</option><option>Other</option>
        </select>
      </div>
      <div class="form-group"><label>Notes</label><textarea id="paymentNotes"></textarea></div>
      <div class="form-actions">
        <button type="button" class="btn btn-primary" onclick="recordPayment()">ğŸ’¾ Record Payment</button>
        <button type="button" class="btn btn-secondary" onclick="resetPaymentForm()">ğŸ—‘ï¸ Clear Form</button>
      </div>
    </div>

    <div class="section-card">
      <h3>ğŸ‘¥ Student Balances</h3>
      <div id="studentBalancesContainer">
        <p style="color:#666;text-align:center;padding:40px;">No payment data yet.</p>
      </div>
    </div>

    <div class="section-card">
      <h3>ğŸ“œ Payment Activity</h3>
      <div id="paymentActivityLog">
        <p style="color:#666;text-align:center;padding:20px;">No recent payment activity.</p>
      </div>
    </div>
  </div>
</div>

    <!-- Reports Tab -->
<div id="reports" class="tab-content">
  <div class="section-header">
    <h2>ğŸ“ˆ Reports</h2>
    <p>Summaries of students, hours, marks, and payments.</p>
  </div>

  <div class="form-grid">
    <div class="section-card">
      <h3>ğŸ“Š Overview</h3>
      <ul>
        <li>Total Students: <span id="totalStudentsReport">0</span></li>
        <li>Total Hours: <span id="totalHoursReport">0</span></li>
        <li>Total Earnings: <span id="totalEarningsReport">$0</span></li>
        <li>Average Mark: <span id="avgMarkReport">0%</span></li>
        <li>Total Payments: <span id="totalPaymentsReport">$0</span></li>
        <li>Outstanding Balance: <span id="outstandingBalance">$0</span></li>
      </ul>
    </div>

    <div class="section-card">
      <h3>ğŸ“… Breakdown</h3>
      <div class="form-actions">
        <button class="btn btn-sm" onclick="showWeeklyBreakdown()">Weekly</button>
        <button class="btn btn-sm" onclick="showBiWeeklyBreakdown()">Bi-Weekly</button>
        <button class="btn btn-sm" onclick="showMonthlyBreakdown()">Monthly</button>
        <button class="btn btn-sm" onclick="showSubjectBreakdown()">By Subject</button>
      </div>
      <table>
        <thead>
          <tr><th>Period</th><th>Hours</th><th>Earnings</th><th>Subjects</th><th>Net (80%)</th></tr>
        </thead>
        <tbody id="weeklyBody">
          <tr><td colspan="5" style="text-align:center;color:#666;padding:20px;">No data available</td></tr>
        </tbody>
      </table>
      <table>
        <thead>
          <tr><th>Subject</th><th>Avg Mark</th><th>Hours</th><th>Earnings</th><th>Sessions</th></tr>
        </thead>
        <tbody id="subjectBody">
          <tr><td colspan="5" style="text-align:center;color:#666;padding:20px;">No data available</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Sync Stats Modal -->
<div id="syncStatsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeSyncStats()">&times;</span>
    <h3>â˜ï¸ Cloud Sync Statistics</h3>
    <div id="syncStatsContent">
      <p>Loading...</p>
    </div>
  </div>
</div>

    <!-- Floating Action Button -->
<div class="fab-container">
  <button id="fab" class="fab">â•</button>
</div>

    <!-- Your Firebase Files -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-manager.js"></script>

    <!-- Auth System -->
    <script type="module" src="auth.js"></script>

    <!-- Main App -->
    <script type="module" src="app.js"></script>

    <!-- Auth Check - Runs after everything is loaded -->
   <script type="module">
  import { auth } from "./firebase-config.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  console.log("ğŸ” Starting auth check on index.html...");

  onAuthStateChanged(auth, user => {
    if (user) {
      console.log("âœ… User authenticated:", user.email);
      // Show app UI
      document.querySelector(".container").style.display = "block";
    } else {
      console.log("ğŸš« No user authenticated - redirecting to login");
      window.location.href = "auth.html";
    }
  });
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="WorkLog Pro">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#4361ee">
  <title>WorkLog - Student Tracker & Hours Management</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <link rel="manifest" href="app.webmanifest">
  <link rel="icon" type="image/svg+xml" href="icons/favicon_cogs32x32.svg">
  <link rel="stylesheet" href="styles.css">
  
</head>

<body>
  <!-- PROFILE MODAL - MOVED TO TOP -->
  <div id="profileModal" class="modal" style="display: none;">
    <div class="modal-content profile-modal">
      <div class="modal-header">
        <h2>ğŸ‘¤ User Profile</h2>
        <button id="closeProfileModal" class="close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- User Info Section -->
        <div class="profile-section">
          <h3>Account Information</h3>
          <div class="info-grid">
            <div class="info-item">
              <label>Email:</label>
              <span id="profileUserEmail">user@example.com</span>
            </div>
            <div class="info-item">
              <label>Member Since:</label>
              <span id="profileUserSince">Loading...</span>
            </div>
            <div class="info-item">
              <label>Default Rate:</label>
              <span id="profileDefaultRate">$0.00/hour</span>
            </div>
          </div>
        </div>

        <!-- Usage Stats Section -->
        <div class="profile-section">
          <h3>ğŸ“Š Usage Statistics</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="modalStatStudents">0</div>
              <div class="stat-label">Students</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="modalStatHours">0</div>
              <div class="stat-label">Hours Worked</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">$<span id="modalStatEarnings">0.00</span></div>
              <div class="stat-label">Money Earned</div>
            </div>
          </div>
          <div class="last-updated">
            Last updated: <span id="modalStatUpdated">Never</span>
          </div>
        </div>

        <!-- Actions Section -->
        <div class="profile-section">
          <h3>Actions</h3>
          <div class="actions-grid">
            <button id="logoutBtn" class="btn btn-danger btn-full">
              ğŸšª Logout
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <div class="logo-title">
        <img src="icons/worklog_cogs.svg" alt="WorkLog Logo" class="logo">
        <h1>WorkLog</h1>
      </div>
      
      <div class="header-main">
        <p class="subtitle">Student Tracker & Hours Management System</p>
        
        <div class="stats-row">
          <div class="storage-status">
            <span id="localStatus">ğŸ’¾ Local Storage: Active</span>
            <span id="syncStatus">â˜ï¸ Cloud Sync: Ready</span>
            <span id="dataStatus">ğŸ“Š Data: <span id="statStudents">0</span> Students, <span id="statHours">0</span> Hours</span>   
          </div>
          
          <div class="header-controls">
            <div class="theme-toggle">
              <button>ğŸŒ“</button>
            </div>
            <div class="auth-section">
              <button id="profileBtn" class="btn btn-secondary">
                ğŸ‘¤ <span id="userName">Loading...</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
     
    <!-- Cloud Sync Bar -->
    <div class="sync-toolbar">
      <div id="syncIndicator"></div>
      <label class="auto-sync-label" id="autoSyncLabel">
        <input type="checkbox" id="autoSyncCheckbox">
        <span class="auto-sync-text" id="autoSyncText">Manual</span>
      </label>

      <button id="syncBtn" class="button primary">ğŸ”„ Sync Now</button>
      <button id="exportCloudBtn" class="button success">Export Cloud</button>
      <button id="importCloudBtn" class="button info">Import Cloud</button>
      <button id="syncStatsBtn" class="button light">Fix Stats</button>

      <button id="exportDataBtn" class="button primary">ğŸ“¤ Export Data</button>
      <button id="importDataBtn" class="button primary">ğŸ“¥ Import Data</button>
      <button id="clearDataBtn" class="button danger">ğŸ—‘ï¸ Clear All</button>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab active" data-tab="students">ğŸ‘¥ Students</button>
        <button class="tab" data-tab="hours">â±ï¸ Hours</button>
        <button class="tab" data-tab="marks">ğŸ“Š Marks</button>
        <button class="tab" data-tab="attendance">âœ… Attendance</button>
        <button class="tab" data-tab="payments">ğŸ’° Payments</button>
        <button class="tab" data-tab="reports">ğŸ“ˆ Reports</button>
      </div>
    </div>

    <!-- Tab Contents -->
    <!-- Students Tab -->
    <div id="students" class="tabcontent active">
      <div class="section-header">
        <h2>ğŸ“š Student Management</h2>
        <div class="student-stats">
          <span class="stat-badge" id="studentCount">0</span>
          <span class="stat-divider">|</span>
          <span class="stat-text">Avg Rate: $<span id="averageRate">0.00</span>/session</span>
        </div>
      </div>

      <!-- Default Rate Settings -->
      <div class="default-rate-panel">
        <h4>ğŸ’° Default Rate Settings</h4>
        <div class="form-group">
          <label for="defaultBaseRate">Set Default Rate ($/session)</label>
          <div class="rate-input-wrapper">
            <span class="currency-symbol">$</span>
            <input type="number" id="defaultBaseRate" step="0.01" min="0" placeholder="25.00">
            <span class="rate-suffix">/ session</span>
          </div>
          <div class="help-text">This rate will be automatically filled for new students</div>
        </div>
        <div class="current-rate-display">
          <span class="current-label">Current Default Rate:</span>
          <span class="current-value">$<span id="currentDefaultRate">0.00</span>/session</span>
        </div>
        <div class="rate-actions">
          <button type="button" class="button success" onclick="saveDefaultRate()">ğŸ’¾ Save Default Rate</button>
          <button type="button" class="button warning" onclick="applyDefaultRateToAll()">ğŸ”„ Apply to All Students</button>
          <button type="button" class="button secondary" onclick="useDefaultRate()">ğŸ“ Use in Student Form</button>
        </div>
      </div>

      <!-- Student Registration Form -->
      <div class="section-card">
        <h3>ğŸ‘¤ Student Registration</h3>
        <form id="studentForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="studentName">Full Name *</label>
              <input type="text" id="studentName" required>
            </div>
            <div class="form-group">
              <label for="studentId">Student ID *</label>
              <input type="text" id="studentId" required>
            </div>
            <div class="form-group">
              <label for="studentGender">Gender *</label>
              <select id="studentGender" required>
                <option value="">Select gender</option>
                <option>Male</option><option>Female</option><option>Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="studentEmail">Email</label>
              <input type="email" id="studentEmail">
            </div>
            <div class="form-group">
              <label for="studentPhone">Phone</label>
              <input type="tel" id="studentPhone">
            </div>
            <div class="form-group">
              <label for="studentBaseRate">Base Rate ($/session)</label>
              <input type="number" id="studentBaseRate" step="0.01" min="0">
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="button primary" id="studentSubmitBtn">â• Add Student</button>
            <button type="button" class="button secondary" onclick="clearStudentForm()">ğŸ—‘ï¸ Clear Form</button>
            <button type="button" class="button warning" id="studentCancelBtn" style="display: none;">âŒ Cancel Edit</button>
          </div>
        </form>
      </div>

      <!-- Student List -->
      <div class="section-card">
        <div class="section-header">
          <h3>ğŸ“‹ Registered Students</h3>
          <div class="list-controls">
            <input type="text" id="studentSearch" placeholder="ğŸ” Search students...">
          </div>
        </div>
        <div class="students-container" id="studentsContainer">
          <p class="empty-message">No students registered yet.</p>
        </div>
      </div>
    </div>

    <!-- Hours Tab -->
    <div id="hours" class="tabcontent">
      <div class="section-header">
        <h2>â±ï¸ Earnings Tracker</h2>
        <div class="student-stats">
          <span class="stat-text">This Week: <span id="weeklyHours">0</span>h / $<span id="weeklyTotal">0</span></span>
          <span class="stat-divider">|</span>
          <span class="stat-text">This Month: <span id="monthlyHours">0</span>h / $<span id="monthlyTotal">0</span></span>
        </div>
      </div>
      
      <div class="user-friendly-stats" style="background: var(--surface); padding: 15px; border-radius: 10px; margin: 15px 0; border: 1px solid var(--border);">
        <div id="weeklySummary" style="font-weight: 500; margin-bottom: 10px;"></div>
        <div id="goalProgress" style="font-size: 0.9em; color: var(--muted);"></div>
      </div>
      
      <div class="form-grid">
        <div class="section-card">
          <h3>â• Log Work & Earnings</h3>
          <!-- Hours form -->
          <div class="form-group">
            <label for="organization">Organization *</label>
            <input type="text" id="organization" required>
          </div>
          <div class="form-group">
            <label for="workSubject">Subject</label>
            <input type="text" id="workSubject" placeholder="e.g., Mathematics, Physics">
          </div>
          <div class="form-group">
            <label for="hoursStudent">Student (Optional)</label>
            <select id="hoursStudent">
              <option value="">Select Student</option>
            </select>
          </div>
          <div class="form-group">
            <label for="workType">Work Type</label>
            <select id="workType">
              <option value="hourly">Hourly</option>
              <option value="session">Per-Session</option>
              <option value="contract">Contract Work</option>
              <option value="project">Project Based</option>
              <option value="consultation">Consultation</option>
              <option value="other">One-off Job</option>
            </select>
            <div class="help-text">
              â€¢ Hourly: Charged per hour worked<br>
              â€¢ Session/Consultation: Flat fee per meeting<br>
              â€¢ Contract/Project/One-off: Fixed amount for the job
            </div>
          </div>
          <div class="form-group">
            <label for="workDate">Date *</label>
            <input type="date" id="workDate" required>
          </div>
          <div class="form-group">
            <label for="hoursWorked">Hours Worked *</label>
            <input type="number" id="hoursWorked" step="0.5" required>
          </div>
          <div class="form-group">
            <label for="baseRate">Your Hourly Rate *</label>
            <input type="number" id="baseRate" step="0.01" required>
            <button type="button" class="button small" onclick="useDefaultRateInHours()">
              Use Default (<span id="currentDefaultRateDisplay">25.00</span>)
            </button>
          </div>
          <div class="form-group">
            <label>Total Earnings</label>
            <div class="total-display" id="totalPay">$0.00</div>
          </div>
          <div class="form-actions">
            <button type="button" class="button primary" id="logHoursBtn">
              <span id="logHoursText">ğŸ’¾ Log Work</span>
              <span id="logHoursSpinner" style="display: none;">â³ Saving...</span>
            </button>
            <button type="button" class="button secondary" onclick="resetHoursForm()">ğŸ—‘ï¸ Clear Form</button>
            <button type="button" class="button warning" id="cancelHoursEdit" style="display: none;">âŒ Cancel Edit</button>
            <button type="button" class="button danger" id="deleteHoursBtn" style="display: none;">ğŸ—‘ï¸ Delete Hours</button>
          </div>
        </div>

        <div class="section-card">
          <h3>ğŸ“Š Recent Earnings</h3>
          <div id="hoursContainer">
            <p class="empty-message">No work logged yet.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Marks Tab -->
    <div id="marks" class="tabcontent">
      <div class="section-header">
        <h2>ğŸ“Š Marks & Assessments</h2>
        <div class="student-stats">
          <span class="stat-badge" id="marksCount">0</span>
          <span class="stat-divider">|</span>
          <span class="stat-text">Avg Score: <span id="avgMarks">0%</span></span>
        </div>
      </div>

      <div class="form-grid">
        <div class="section-card">
          <h3>â• Add New Mark</h3>
          <form id="marksForm">
            <div class="form-group">
              <label for="marksStudent">Student *</label>
              <select id="marksStudent" required>
                <option value="">Select Student</option>
              </select>
            </div>
            <div class="form-group">
              <label for="marksSubject">Subject *</label>
              <input type="text" id="marksSubject" required>
            </div>
            <div class="form-group">
              <label for="marksTopic">Topic *</label>
              <input type="text" id="marksTopic" required>
            </div>
            <div class="form-group">
              <label for="marksDate">Date *</label>
              <input type="date" id="marksDate" required>
            </div>
            <div class="form-group">
              <label for="marksScore">Score *</label>
              <input type="number" id="marksScore" step="0.1" required oninput="updateMarksPercentage()">
            </div>
            <div class="form-group">
              <label for="marksMax">Max Score *</label>
              <input type="number" id="marksMax" step="0.1" required oninput="updateMarksPercentage()">
            </div>
            <div class="form-group">
              <label for="percentage">Percentage</label>
              <input type="text" id="percentage" readonly>
            </div>
            <div class="form-group">
              <label for="grade">Grade</label>
              <input type="text" id="grade" readonly>
            </div>
            <div class="form-group">
              <label for="marksNotes">Notes</label>
              <textarea id="marksNotes"></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="button primary" id="addMarkBtn">â• Add Mark</button>
              <button type="button" class="button secondary" onclick="resetMarksForm()">ğŸ—‘ï¸ Clear Form</button>
              <button type="button" class="button warning" id="cancelMarkBtn" style="display: none;">âŒ Cancel Edit</button>
              <button type="button" class="button danger" id="deleteMarkBtn" style="display: none;">ğŸ—‘ï¸ Delete Mark</button>
            </div>
          </form>
        </div>

        <div class="section-card">
          <h3>ğŸ“‹ Recent Marks</h3>
          <div id="marksContainer">
            <p class="empty-message">No marks recorded yet.</p>
          </div>
        </div>
      </div>
    </div>

  <!-- Attendance Tab -->
<div id="attendance" class="tabcontent">
  <div class="section-header">
    <h2>âœ… Attendance Tracking</h2>
    <div class="student-stats">
      <span class="stat-badge" id="attendanceCount">0</span>
      <span class="stat-divider">|</span>
      <span class="stat-text">Last Session: <span id="lastSessionDate">Never</span></span>
    </div>
  </div>

  <div class="form-grid">
    <div class="section-card">
      <h3>ğŸ“… Quick Attendance</h3>
      <form id="attendanceForm"> <!-- Added form element -->
        <div class="form-group">
          <label for="attendanceDate">Date *</label>
          <input type="date" id="attendanceDate" name="attendanceDate" required> <!-- Added name attribute -->
        </div>
        <div class="form-group">
          <label for="attendanceSubject">Subject *</label>
          <input type="text" id="attendanceSubject" name="attendanceSubject" required> <!-- Added name attribute -->
        </div>
        <div class="form-group">
          <label for="attendanceTopic">Topic</label>
          <input type="text" id="attendanceTopic" name="attendanceTopic"> <!-- Added name attribute -->
        </div>
        
        <!-- Attendance Students Section -->
        <div class="form-group">
          <label>Mark Students Present:</label>
          <button type="button" id="selectAllStudentsBtn" class="btn btn-secondary">
            Select All
          </button>
          <div id="attendanceStudents" class="attendance-students-container">
            <!-- Student checkboxes will be populated here -->
            <p class="empty-message">No students registered. Add students first.</p>
          </div>
        </div>

        <div class="form-group">
          <label for="attendanceNotes">Notes</label>
          <textarea id="attendanceNotes" name="attendanceNotes"></textarea> <!-- Added name attribute -->
        </div>

        <div class="form-actions">
          <button type="submit" class="button primary" id="saveAttendanceBtn">ğŸ’¾ Save Attendance</button> <!-- Changed to type="submit" -->
          <button type="button" class="button secondary" onclick="clearAttendanceForm()">ğŸ—‘ï¸ Clear Form</button>
          <button type="button" class="button warning" id="cancelAttendanceBtn" style="display: none;">âŒ Cancel Edit</button>
          <button type="button" class="button danger" id="deleteAttendanceBtn" style="display: none;">ğŸ—‘ï¸ Delete Attendance</button>
        </div>
      </form> <!-- Closing form tag -->
    </div>

    <div class="section-card">
      <h3>ğŸ“‹ Recent Attendance</h3>
      <div id="attendanceContainer">
        <p class="empty-message">No attendance records yet.</p>
      </div>
    </div>
  </div>
</div>
    <!-- Payments Tab -->
    <div id="payments" class="tabcontent">
      <div class="section-header">
        <h2>ğŸ’° Payment Management</h2>
        <div class="student-stats">
          <span class="stat-text">Total Students: <span id="totalStudentsCount">0</span></span>
          <span class="stat-divider">|</span>
          <span class="stat-text">Total Owed: <span id="totalOwed">$0</span></span>
          <span class="stat-divider">|</span>
          <span class="stat-text">This Month: <span id="monthlyPayments">$0</span></span>
        </div>
      </div>

      <div class="form-grid">
        <div class="section-card">
          <h3>ğŸ’³ Record Payment</h3>
          <div class="form-group">
            <label for="paymentStudent">Student *</label>
            <select id="paymentStudent" required>
              <option value="">Select Student</option>
            </select>
          </div>
          <div class="form-group">
            <label for="paymentAmount">Amount ($) *</label>
            <input type="number" id="paymentAmount" step="0.01" min="0.01" required>
          </div>
          <div class="form-group">
            <label for="paymentDate">Date *</label>
            <input type="date" id="paymentDate" required>
          </div>
          <div class="form-group">
            <label for="paymentMethod">Method</label>
            <select id="paymentMethod">
              <option>Cash</option>
              <option>Bank Transfer</option>
              <option>Credit Card</option>
              <option>PayPal</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="paymentNotes">Notes</label>
            <textarea id="paymentNotes"></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="button primary" id="recordPaymentBtn">ğŸ’¾ Record Payment</button>
            <button type="button" class="button secondary" onclick="resetPaymentForm()">ğŸ—‘ï¸ Clear Form</button>
            <button type="button" class="button warning" id="cancelPaymentBtn" style="display: none;">âŒ Cancel Edit</button>
            <button type="button" class="button danger" id="deletePaymentBtn" style="display: none;">ğŸ—‘ï¸ Delete Payment</button>
          </div>
        </div>

        <div class="section-card">
          <h3>ğŸ‘¥ Student Balances</h3>
          <div id="studentBalancesContainer">
            <p class="empty-message">No payment data yet.</p>
          </div>
        </div>

        <div class="section-card">
          <h3>ğŸ“œ Payment Activity</h3>
          <div id="paymentActivityLog">
            <p class="empty-message">No recent payment activity.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tabcontent">
      <div class="section-header">
        <h2>ğŸ“ˆ Reports</h2>
        <p>Summaries of students, hours, marks, and payments.</p>
      </div>

      <div class="form-grid">
        <div class="section-card">
          <h3>ğŸ“Š Overview</h3>
          <ul>
            <li>Total Students: <span id="totalStudentsReport">0</span></li>
            <li>Total Hours: <span id="totalHoursReport">0</span></li>
            <li>Total Earnings: <span id="totalEarningsReport">$0</span></li>
            <li>Average Mark: <span id="avgMarkReport">0%</span></li>
            <li>Total Payments: <span id="totalPaymentsReport">$0</span></li>
            <li>Outstanding Balance: <span id="outstandingBalance">$0</span></li>
          </ul>
        </div>

        <div class="section-card">
          <h3>ğŸ“… Breakdown</h3>
          <div class="form-actions">
            <button class="button small" onclick="showWeeklyBreakdown()">Weekly</button>
            <button class="button small" onclick="showBiWeeklyBreakdown()">Bi-Weekly</button>
            <button class="button small" onclick="showMonthlyBreakdown()">Monthly</button>
            <button class="button small" onclick="showSubjectBreakdown()">By Subject</button>
          </div>
          <table class="table">
            <thead>
              <tr><th>Period</th><th>Hours</th><th>Earnings</th><th>Subjects</th><th>Net (80%)</th></tr>
            </thead>
            <tbody id="weeklyBody">
              <tr><td colspan="5" class="empty-message">No data available</td></tr>
            </tbody>
          </table>
          <table class="table">
            <thead>
              <tr><th>Subject</th><th>Avg Mark</th><th>Hours</th><th>Earnings</th><th>Sessions</th></tr>
            </thead>
            <tbody id="subjectBody">
              <tr><td colspan="5" class="empty-message">No data available</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Sync Stats Modal -->
    <div id="syncStatsModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeSyncStats()">&times;</span>
        <h3>â˜ï¸ Cloud Sync Statistics</h3>
        <div id="syncStatsContent">
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div> <!-- End of container -->

  <!-- Floating Action Button - OUTSIDE ALL TAB CONTENT -->
  <div class="fab-container">
    <button id="floatingAddBtn" class="fab">+</button>
    <div id="fabMenu" class="fab-menu">
      <button id="fabAddStudent" class="fab-item">
        <span class="icon">ğŸ‘¤</span>
        Add Student
      </button>
      <button id="fabAddHours" class="fab-item">
        <span class="icon">â±ï¸</span>
        Log Hours
      </button>
      <button id="fabAddMark" class="fab-item">
        <span class="icon">ğŸ“</span>
        Add Mark
      </button>
      <button id="fabAddAttendance" class="fab-item">
        <span class="icon">âœ…</span>
        Take Attendance
      </button>
    </div>
    <div id="fabOverlay" class="fab-overlay"></div>
  </div>

 <!-- Replace your entire script section at the bottom with this: -->

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase and App Scripts -->
<script type="module" src="app.js"></script>

<script>
  // DOM elements - WAIT FOR DOM TO BE READY
  document.addEventListener('DOMContentLoaded', function() {
    console.log("ğŸ“‹ Initializing tabs and UI...");
    
    // ==================== PROFILE MODAL ====================
    const profileBtn = document.getElementById('profileBtn');
    const profileModal = document.getElementById('profileModal');
    const closeProfileModal = document.getElementById('closeProfileModal');
    const logoutBtn = document.getElementById('logoutBtn');
    
    // Profile modal functionality
    if (profileBtn && profileModal) {
      profileBtn.addEventListener('click', function() {
        updateProfileInfo();
        profileModal.style.display = 'block';
      });
    }
    
    if (closeProfileModal) {
      closeProfileModal.addEventListener('click', function() {
        profileModal.style.display = 'none';
      });
    }
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target === profileModal) {
        profileModal.style.display = 'none';
      }
    });
    
    // Logout functionality
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          // Clear localStorage
          localStorage.clear();
          
          // If using Firebase auth, sign out
          if (typeof firebase !== 'undefined' && firebase.auth()) {
            firebase.auth().signOut().then(() => {
              window.location.href = 'login.html';
            }).catch(error => {
              console.error('Logout error:', error);
              window.location.href = 'login.html';
            });
          } else {
            window.location.href = 'login.html';
          }
        }
      });
    }
    
    // ==================== SYNC & DATA BUTTONS ====================
    const syncBtn = document.getElementById('syncBtn');
    const exportCloudBtn = document.getElementById('exportCloudBtn');
    const importCloudBtn = document.getElementById('importCloudBtn');
    const syncStatsBtn = document.getElementById('syncStatsBtn');
    const exportDataBtn = document.getElementById('exportDataBtn');
    const importDataBtn = document.getElementById('importDataBtn');
    const clearDataBtn = document.getElementById('clearDataBtn');
    
    // Sync button
    if (syncBtn) {
      syncBtn.addEventListener('click', function() {
        alert('Sync functionality would connect to Firebase');
        console.log('Sync button clicked');
      });
    }
    
    // Export Cloud button
    if (exportCloudBtn) {
      exportCloudBtn.addEventListener('click', function() {
        alert('Export to cloud functionality');
        console.log('Export Cloud button clicked');
      });
    }
    
    // Import Cloud button
    if (importCloudBtn) {
      importCloudBtn.addEventListener('click', function() {
        alert('Import from cloud functionality');
        console.log('Import Cloud button clicked');
      });
    }
    
    // Sync Stats button
    if (syncStatsBtn) {
      syncStatsBtn.addEventListener('click', function() {
        alert('Sync statistics functionality');
        console.log('Sync Stats button clicked');
      });
    }
    
    // Export Data button
    if (exportDataBtn) {
      exportDataBtn.addEventListener('click', exportData);
    }
    
    // Import Data button
    if (importDataBtn) {
      importDataBtn.addEventListener('click', importData);
    }
    
    // Clear Data button
    if (clearDataBtn) {
      clearDataBtn.addEventListener('click', clearAllData);
    }
    
    // ==================== TAB SWITCHING ====================
    const tabButtons = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tabcontent');
    
    if (tabButtons.length > 0 && tabContents.length > 0) {
      console.log("ğŸ“‹ Initializing tabs...");
      
      function switchTab(tabName) {
        console.log("Switching to tab:", tabName);
        
        // Hide all tab contents
        tabContents.forEach(content => {
          content.classList.remove('active');
        });
        
        // Remove active class from all tab buttons
        tabButtons.forEach(button => {
          button.classList.remove('active');
        });
        
        // Show the selected tab content
        const selectedTab = document.getElementById(tabName);
        if (selectedTab) {
          selectedTab.classList.add('active');
        }
        
        // Activate the clicked tab button
        const activeButton = document.querySelector(`.tab[data-tab="${tabName}"]`);
        if (activeButton) {
          activeButton.classList.add('active');
        }
      }
      
      // Add click event to all tab buttons
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          switchTab(tabName);
        });
      });
      
      // Initialize with Students tab active
      switchTab('students');
      
      console.log("âœ… Tabs initialized");
    }
    
    // ==================== FLOATING ACTION BUTTON ====================
    const fab = document.getElementById('floatingAddBtn');
    const fabMenu = document.getElementById('fabMenu');
    const fabOverlay = document.getElementById('fabOverlay');
    
    if (fab && fabMenu && fabOverlay) {
      fab.addEventListener('click', function() {
        const isActive = fabMenu.classList.contains('active');
        
        if (isActive) {
          fabMenu.classList.remove('active');
          fabOverlay.style.display = 'none';
        } else {
          fabMenu.classList.add('active');
          fabOverlay.style.display = 'block';
        }
      });
      
      fabOverlay.addEventListener('click', function() {
        fabMenu.classList.remove('active');
        fabOverlay.style.display = 'none';
      });
      
      // FAB menu items
      const fabAddStudent = document.getElementById('fabAddStudent');
      const fabAddHours = document.getElementById('fabAddHours');
      const fabAddMark = document.getElementById('fabAddMark');
      const fabAddAttendance = document.getElementById('fabAddAttendance');
      
      if (fabAddStudent) {
        fabAddStudent.addEventListener('click', function() {
          switchTab('students');
          document.getElementById('studentName')?.focus();
          fabMenu.classList.remove('active');
          fabOverlay.style.display = 'none';
        });
      }
      
      if (fabAddHours) {
        fabAddHours.addEventListener('click', function() {
          switchTab('hours');
          document.getElementById('organization')?.focus();
          fabMenu.classList.remove('active');
          fabOverlay.style.display = 'none';
        });
      }
      
      if (fabAddMark) {
        fabAddMark.addEventListener('click', function() {
          switchTab('marks');
          document.getElementById('marksStudent')?.focus();
          fabMenu.classList.remove('active');
          fabOverlay.style.display = 'none';
        });
      }
      
      if (fabAddAttendance) {
        fabAddAttendance.addEventListener('click', function() {
          switchTab('attendance');
          document.getElementById('attendanceDate')?.focus();
          fabMenu.classList.remove('active');
          fabOverlay.style.display = 'none';
        });
      }
    }
    
    // ==================== THEME TOGGLE ====================
    const themeToggle = document.querySelector('.theme-toggle button');
    if (themeToggle) {
      // Set initial theme
      const savedTheme = localStorage.getItem('worklog-theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      document.body.className = savedTheme;
      themeToggle.textContent = savedTheme === 'dark' ? 'ğŸŒ“' : 'ğŸŒ';
      
      themeToggle.addEventListener('click', function() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        document.body.className = newTheme;
        localStorage.setItem('worklog-theme', newTheme);
        
        themeToggle.textContent = newTheme === 'dark' ? 'ğŸŒ“' : 'ğŸŒ';
      });
    }
    
    // ==================== AUTO-FILL DATES ====================
    const today = new Date().toISOString().split('T')[0];
    ['workDate', 'marksDate', 'attendanceDate', 'paymentDate'].forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        element.setAttribute('value', today);
        element.value = today;
      }
    });
    
    // ==================== INITIALIZE STATS ====================
    updateStats();
    updateProfileInfo();
    
    console.log("âœ… UI initialization complete");
  });
  
  // ==================== PROFILE FUNCTIONS ====================
  function updateProfileInfo() {
    const userEmail = localStorage.getItem('userEmail') || 'Not logged in';
    const userName = localStorage.getItem('userName') || 'Guest';
    
    // Update profile button
    const profileBtn = document.getElementById('profileBtn');
    if (profileBtn) {
      const userNameSpan = profileBtn.querySelector('#userName');
      if (userNameSpan) {
        userNameSpan.textContent = userName;
      }
    }
    
    // Update profile modal
    const profileUserEmail = document.getElementById('profileUserEmail');
    if (profileUserEmail) {
      profileUserEmail.textContent = userEmail;
    }
    
    const profileUserSince = document.getElementById('profileUserSince');
    if (profileUserSince) {
      const memberSince = localStorage.getItem('memberSince') || new Date().toLocaleDateString();
      profileUserSince.textContent = memberSince;
    }
    
    const profileDefaultRate = document.getElementById('profileDefaultRate');
    if (profileDefaultRate) {
      const defaultRate = localStorage.getItem('defaultHourlyRate') || '0.00';
      profileDefaultRate.textContent = `$${parseFloat(defaultRate).toFixed(2)}/hour`;
    }
    
    // Update stats in modal
    updateModalStats();
  }
  
  function updateModalStats() {
    // Get student count
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    const modalStatStudents = document.getElementById('modalStatStudents');
    if (modalStatStudents) {
      modalStatStudents.textContent = students.length;
    }
    
    // Get hours count
    const hours = JSON.parse(localStorage.getItem('hours') || '[]');
    const modalStatHours = document.getElementById('modalStatHours');
    if (modalStatHours) {
      modalStatHours.textContent = hours.length;
    }
    
    // Calculate earnings
    let totalEarnings = 0;
    hours.forEach(hour => {
      totalEarnings += (hour.hours || 0) * (hour.rate || 0);
    });
    
    const modalStatEarnings = document.getElementById('modalStatEarnings');
    if (modalStatEarnings) {
      modalStatEarnings.textContent = totalEarnings.toFixed(2);
    }
    
    const modalStatUpdated = document.getElementById('modalStatUpdated');
    if (modalStatUpdated) {
      modalStatUpdated.textContent = new Date().toLocaleString();
    }
  }
  
  function updateStats() {
    // Get data from localStorage
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    const hours = JSON.parse(localStorage.getItem('hours') || '[]');
    
    // Update main stats display
    const statStudents = document.getElementById('statStudents');
    if (statStudents) {
      statStudents.textContent = students.length;
    }
    
    const statHours = document.getElementById('statHours');
    if (statHours) {
      statHours.textContent = hours.length;
    }
    
    // Update student count in students tab
    const studentCount = document.getElementById('studentCount');
    if (studentCount) {
      studentCount.textContent = students.length;
    }
    
    // Calculate and display average rate
    let totalRate = 0;
    students.forEach(student => {
      totalRate += parseFloat(student.hourlyRate || localStorage.getItem('defaultHourlyRate') || '0');
    });
    const avgRate = students.length > 0 ? totalRate / students.length : 0;
    
    const averageRate = document.getElementById('averageRate');
    if (averageRate) {
      averageRate.textContent = avgRate.toFixed(2);
    }
  }
  
  // ==================== DATA MANAGEMENT FUNCTIONS ====================
  function exportData() {
    const data = {
      students: JSON.parse(localStorage.getItem('students') || '[]'),
      hours: JSON.parse(localStorage.getItem('hours') || '[]'),
      marks: JSON.parse(localStorage.getItem('marks') || '[]'),
      attendance: JSON.parse(localStorage.getItem('attendance') || '[]'),
      payments: JSON.parse(localStorage.getItem('payments') || '[]'),
      settings: {
        defaultRate: localStorage.getItem('defaultHourlyRate'),
        theme: localStorage.getItem('worklog-theme'),
        exportDate: new Date().toISOString()
      }
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `worklog-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert('Data exported successfully!');
  }
  
  function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (confirm('This will overwrite all current data. Continue?')) {
            // Import data
            if (data.students) localStorage.setItem('students', JSON.stringify(data.students));
            if (data.hours) localStorage.setItem('hours', JSON.stringify(data.hours));
            if (data.marks) localStorage.setItem('marks', JSON.stringify(data.marks));
            if (data.attendance) localStorage.setItem('attendance', JSON.stringify(data.attendance));
            if (data.payments) localStorage.setItem('payments', JSON.stringify(data.payments));
            
            // Import settings
            if (data.settings) {
              if (data.settings.defaultRate) localStorage.setItem('defaultHourlyRate', data.settings.defaultRate);
              if (data.settings.theme) {
                localStorage.setItem('worklog-theme', data.settings.theme);
                document.documentElement.setAttribute('data-theme', data.settings.theme);
                document.body.className = data.settings.theme;
              }
            }
            
            // Update UI
            updateStats();
            updateModalStats();
            
            alert('Data imported successfully! Page will reload.');
            setTimeout(() => {
              window.location.reload();
            }, 1000);
          }
        } catch (error) {
          alert('Error importing data: Invalid file format');
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  }
  
  function clearAllData() {
    if (confirm('âš ï¸ WARNING: This will delete ALL data including students, hours, marks, attendance, and payments. This action cannot be undone.\n\nAre you absolutely sure?')) {
      if (confirm('LAST CHANCE: This will delete everything. Continue?')) {
        // Clear all localStorage data
        localStorage.clear();
        
        // Reset default rate
        localStorage.setItem('defaultHourlyRate', '25.00');
        localStorage.setItem('worklog-theme', 'dark');
        
        // Update UI
        updateStats();
        updateModalStats();
        
        alert('All data has been cleared. Page will reload.');
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      }
    }
  }
</script>
</body>
</html>
